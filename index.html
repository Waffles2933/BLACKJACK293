<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Blackjack Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:#0b1220; color:#e6eef8; display:flex; flex-direction:column; align-items:center; padding:20px; }
.table { width: 90%; max-width: 900px; background:#0f1724; padding:20px; border-radius:12px; box-shadow:0 10px 30px rgba(2,6,23,0.6); margin-bottom:20px; }
h1 { text-align:center; margin-bottom:10px; }
.hand { background:#071026; padding:10px; border-radius:8px; margin-bottom:12px; }
.cards { display:flex; gap:6px; flex-wrap:wrap; margin-top:6px; }
.card { width:50px; height:70px; border-radius:6px; background:#fff; color:#000; display:flex; flex-direction:column; justify-content:space-between; padding:4px; font-weight:700; text-align:center; }
.controls { display:flex; gap:6px; justify-content:center; margin:10px 0; flex-wrap:wrap; }
button { padding:6px 10px; border-radius:6px; border:none; background:#0ea5a6; color:#042027; font-weight:700; cursor:pointer; }
button:disabled { opacity:0.5; cursor:default; }
.status { text-align:center; font-weight:700; margin:8px 0; }
.score { font-weight:800; color:#9ad1d1; }
.bet-chips { text-align:center; margin-bottom:8px; }
</style>
</head>
<body>

<h1>Blackjack Pro</h1>

<div class="bet-chips">
  Chips: <span id="chips">100</span> | Bet: <span id="currentBet">0</span>
</div>

<div class="table" id="dealerPanel">
  <div class="hand">
    <strong>Dealer</strong> <span class="score" id="dealerScore">—</span>
    <div class="cards" id="dealerCards"></div>
  </div>
</div>

<div class="table" id="playerPanel"></div>

<div class="controls">
  <button id="dealBtn">Deal</button>
  <button id="hitBtn" disabled>Hit</button>
  <button id="standBtn" disabled>Stand</button>
  <button id="doubleBtn" disabled>Double Down</button>
  <button id="splitBtn" disabled>Split</button>
  <button id="restartBtn">Restart</button>
</div>

<div class="status" id="status">Place your bet and press Deal.</div>

<script>
// --- Blackjack Pro JS ---
const SUITS = ['♠','♥','♦','♣'];
const RANKS = [
  {r:'A', value:11},{r:'2', value:2},{r:'3', value:3},{r:'4', value:4},{r:'5', value:5},
  {r:'6', value:6},{r:'7', value:7},{r:'8', value:8},{r:'9', value:9},{r:'10', value:10},
  {r:'J', value:10},{r:'Q', value:10},{r:'K', value:10},
];

let deck = [];
let dealer = [];
let playerHands = []; // each hand: {cards:[...], bet:number, finished:boolean, doubled:boolean}
let currentHandIndex = 0;
let gameOver = true;
let chips = 100;

const dealerCardsEl = document.getElementById('dealerCards');
const dealerScoreEl = document.getElementById('dealerScore');
const playerPanelEl = document.getElementById('playerPanel');
const statusEl = document.getElementById('status');
const chipsEl = document.getElementById('chips');
const currentBetEl = document.getElementById('currentBet');

const dealBtn = document.getElementById('dealBtn');
const hitBtn = document.getElementById('hitBtn');
const standBtn = document.getElementById('standBtn');
const doubleBtn = document.getElementById('doubleBtn');
const splitBtn = document.getElementById('splitBtn');
const restartBtn = document.getElementById('restartBtn');

function buildDeck(){
  const d=[];
  for(const s of SUITS){
    for(const r of RANKS){
      d.push({suit:s, rank:r.r, value:r.value});
    }
  }
  return d;
}

function shuffle(deck){
  for(let i=deck.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [deck[i],deck[j]]=[deck[j],deck[i]];
  }
}

function dealCard(to){
  if(deck.length===0){deck=buildDeck();shuffle(deck);}
  const card=deck.pop();
  to.push(card);
  return card;
}

function calculateScore(hand){
  let sum=0, aces=0;
  for(const c of hand){
    sum+=c.value;
    if(c.rank==='A') aces++;
  }
  while(sum>21 && aces>0){sum-=10; aces--;}
  return sum;
}

function renderCard(card, hidden=false){
  const div=document.createElement('div');
  div.className='card'+(hidden?' hidden-card':'');
  div.innerHTML=`<div>${hidden?'&nbsp;':card.rank}</div><div>${hidden?'&nbsp;':card.suit}</div><div>${hidden?'&nbsp;':card.rank}</div>`;
  return div;
}

function renderDealer(showAll=false){
  dealerCardsEl.innerHTML='';
  dealer.forEach((c,idx)=>{
    const hidden=!showAll && idx===1;
    dealerCardsEl.appendChild(renderCard(c,hidden));
  });
  dealerScoreEl.textContent='Score: '+(showAll?calculateScore(dealer):'?');
}

function renderPlayer(){
  playerPanelEl.innerHTML='';
  playerHands.forEach((hand,i)=>{
    const div=document.createElement('div');
    div.className='hand';
    div.innerHTML=`<strong>Hand ${i+1}</strong> <span class="score">Score: ${calculateScore(hand.cards)}</span>`;
    const cardsDiv=document.createElement('div'); cardsDiv.className='cards';
    hand.cards.forEach(c=>cardsDiv.appendChild(renderCard(c,false)));
    div.appendChild(cardsDiv);
    if(i===currentHandIndex && !hand.finished) div.style.border='2px solid #0ea5a6';
    playerPanelEl.appendChild(div);
  });
}

function toggleButtons(){
  if(gameOver){
    dealBtn.disabled=false;
    hitBtn.disabled=true;
    standBtn.disabled=true;
    doubleBtn.disabled=true;
    splitBtn.disabled=true;
  }else{
    dealBtn.disabled=true;
    const hand=playerHands[currentHandIndex];
    hitBtn.disabled=hand.finished;
    standBtn.disabled=hand.finished;
    doubleBtn.disabled=hand.finished || hand.cards.length!==2 || chips<hand.bet;
    splitBtn.disabled=hand.finished || hand.cards.length!==2 || hand.cards[0].rank!==hand.cards[1].rank || playerHands.length>=4 || chips<hand.bet;
  }
}

function nextHand(){
  currentHandIndex++;
  if(currentHandIndex>=playerHands.length){
    dealerTurn();
  }else{
    statusEl.textContent=`Playing hand ${currentHandIndex+1}`;
    toggleButtons();
    renderPlayer();
  }
}

function playerHit(){
  const hand=playerHands[currentHandIndex];
  dealCard(hand.cards);
  if(calculateScore(hand.cards)>21) hand.finished=true;
  renderPlayer();
  toggleButtons();
  if(hand.finished) nextHand();
}

function playerStand(){
  playerHands[currentHandIndex].finished=true;
  nextHand();
}

function playerDouble(){
  const hand=playerHands[currentHandIndex];
  if(chips>=hand.bet){
    chips-=hand.bet;
    hand.bet*=2;
    hand.doubled=true;
    dealCard(hand.cards);
    hand.finished=true;
    renderPlayer();
    updateChips();
    nextHand();
  }
}

function playerSplit(){
  const hand=playerHands[currentHandIndex];
  if(playerHands.length>=4) return;
  if(chips<hand.bet) return;
  chips-=hand.bet;
  const newHand={cards:[hand.cards.pop()],bet:hand.bet,finished:false,doubled:false};
  dealCard(hand.cards);
  dealCard(newHand.cards);
  playerHands.splice(currentHandIndex+1,0,newHand);
  renderPlayer();
  updateChips();
  toggleButtons();
}

async function dealerTurn(){
  renderDealer(true);
  let score=calculateScore(dealer);
  while(score<17 || (score===17 && dealer.some(c=>c.rank==='A' && calculateScore(dealer)<=17))){
    await new Promise(r=>setTimeout(r,500));
    dealCard(dealer);
    renderDealer(true);
    score=calculateScore(dealer);
  }
  settleBets();
}

function settleBets(){
  const dealerScore=calculateScore(dealer);
  let results=[];
  playerHands.forEach(hand=>{
    const s=calculateScore(hand.cards);
    if(s>21) results.push(`Hand busts. Lose ${hand.bet}`);
    else if(s===21 && hand.cards.length===2 && dealerScore!==21) {
      chips+=hand.bet*2.5;
      results.push(`Blackjack! Win ${hand.bet*1.5}`);
    }
    else if(dealerScore>21 || s>dealerScore){
      chips+=hand.bet*2;
      results.push(`Win ${hand.bet}`);
    } else if(s===dealerScore){
      chips+=hand.bet;
      results.push(`Push`);
    } else results.push(`Lose ${hand.bet}`);
  });
  statusEl.innerHTML=results.join('<br>');
  gameOver=true;
  updateChips();
  toggleButtons();
  renderDealer(true);
}

function updateChips(){
  chipsEl.textContent
