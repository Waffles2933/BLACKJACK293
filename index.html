<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Blackjack Ultimate</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:#0b1220;color:#e6eef8;display:flex;flex-direction:column;align-items:center;padding:20px;position:relative;transition:background 0.3s,color 0.3s;}
body.light{background:#f0f0f0;color:#000;}
h1{text-align:center;margin-bottom:10px;}
.table{width:90%;max-width:1000px;background:#0f1724;padding:20px;border-radius:12px;box-shadow:0 10px 30px rgba(2,6,23,0.6);margin-bottom:20px;}
body.light .table{background:#fff;color:#000;box-shadow:0 10px 30px rgba(0,0,0,0.2);}
.hand{background:#071026;padding:10px;border-radius:8px;margin-bottom:12px;position:relative;transition:border 0.2s;}
body.light .hand{background:#e0e0e0;}
.cards{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px;}
.card{
  width: 60px;
  height: 85px;
  border-radius: 8px;
  background: #fff;
  color: #000;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 4px;
  font-weight: 700;
  text-align: center;
  box-shadow: 0 4px 8px rgba(0,0,0,0.4);
  position: relative;
  font-family: 'Arial Black', Arial, sans-serif;
}
.card.red { color: #e11d48; }
.card .top-left,
.card .bottom-right { font-size: 14px; position: absolute; }
.card .top-left { top: 4px; left: 4px; }
.card .bottom-right { bottom: 4px; right: 4px; transform: rotate(180deg); }
.card .center { font-size: 24px; }
.card.animate{transform:translateY(-10px);}
.hidden-card{
  background: linear-gradient(135deg,#334155,#0f1724);
  color: transparent;
  position: relative;
  overflow: hidden;
}
.hidden-card::after{
  content: "";
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(45deg, rgba(255,255,255,0.03) 0 6px, transparent 6px 12px);
}
.controls{display:flex;gap:6px;justify-content:center;margin:10px 0;flex-wrap:wrap;}
button{padding:6px 10px;border-radius:6px;border:none;background:#0ea5a6;color:#042027;font-weight:700;cursor:pointer;}
button:disabled{opacity:0.5;cursor:default;}
.status{text-align:center;font-weight:700;margin:8px 0;}
.score{font-weight:900;color:#9ad1d1;font-size:20px;}
body.light .score{color:#0a9396;}
.bet-chips{text-align:center;margin-bottom:8px;}
input[type=number]{width:60px;padding:4px;border-radius:4px;border:none;font-weight:700;}
#keySettingsBtn,#themeToggleBtn{position:absolute;top:10px;padding:6px 10px;font-weight:700;}
#keySettingsBtn{right:120px;background:#facc15;color:#042027;}
#themeToggleBtn{right:10px;background:#94a3b8;color:#042027;}
#keyModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);justify-content:center;align-items:center;}
.modal-content{background:#0f1724;padding:20px;border-radius:10px;display:flex;flex-direction:column;gap:8px;}
.modal-content input{width:60px;padding:4px;border-radius:4px;border:none;font-weight:700;}
.notification{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);padding:20px 30px;font-size:28px;font-weight:900;color:#f00;background:rgba(255,255,255,0.1);border-radius:12px;pointer-events:none;opacity:0;transition:opacity 0.5s;}
.chip-stack{display:inline-block;width:30px;height:15px;margin:0 1px;background:red;border-radius:50%;vertical-align:middle;}
#stats{margin-top:10px;font-size:14px;text-align:center;}
#dealerHistory{margin-bottom:6px;font-size:14px;text-align:center;}
</style>
</head>
<body>

<h1>Blackjack Ultimate</h1>
<button id="keySettingsBtn">Custom Keys</button>
<button id="themeToggleBtn">Toggle Theme</button>

<div class="bet-chips">
  Chips: <span id="chips">1000</span> | Bet: <input type="number" id="betInput" min="1" max="1000" value="10">
  <button id="preset10">10</button>
  <button id="preset50">50</button>
  <button id="preset100">100</button>
</div>

<div id="dealerHistory">Dealer Last Cards: </div>

<div class="table" id="dealerPanel">
  <div class="hand">
    <strong>Dealer</strong> <span class="score" id="dealerScore">—</span>
    <div class="cards" id="dealerCards"></div>
  </div>
</div>

<div class="table" id="playerPanel"></div>

<div class="controls">
  <button id="dealBtn">Deal</button>
  <button id="hitBtn" disabled>Hit</button>
  <button id="standBtn" disabled>Stand</button>
  <button id="doubleBtn" disabled>Double Down</button>
  <button id="splitBtn" disabled>Split</button>
  <button id="insuranceBtn" disabled>Insurance</button>
  <button id="surrenderBtn" disabled>Surrender</button>
  <button id="restartBtn">Restart</button>
</div>

<div class="status" id="status">Set your bet and press Deal.</div>
<div id="stats">Wins: 0 | Losses: 0 | Blackjacks: 0</div>
<div id="notification" class="notification"></div>

<!-- Key modal -->
<div id="keyModal">
  <div class="modal-content">
    <label>Hit: <input id="keyHit" maxlength="1" value="h"></label>
    <label>Stand: <input id="keyStand" maxlength="1" value="s"></label>
    <label>Double: <input id="keyDouble" maxlength="1" value="d"></label>
    <label>Split: <input id="keySplit" maxlength="1" value="p"></label>
    <label>Redeal: <input id="keyRedeal" maxlength="1" value="r"></label>
    <button id="saveKeysBtn">Save Keys</button>
  </div>
</div>

<script>
// --- Variables ---
const SUITS=['♠','♥','♦','♣'],RANKS=[{r:'A',value:11},{r:'2',value:2},{r:'3',value:3},{r:'4',value:4},{r:'5',value:5},{r:'6',value:6},{r:'7',value:7},{r:'8',value:8},{r:'9',value:9},{r:'10',value:10},{r:'J',value:10},{r:'Q',value:10},{r:'K',value:10}];
let deck=[],dealer=[],playerHands=[],currentHandIndex=0,gameOver=true,chips=1000,stats={wins:0,losses:0,blackjacks:0},dealerHistory=[];
let keyMap={hit:'h',stand:'s',double:'d',split:'p',redeal:'r'};

const dealerCardsEl=document.getElementById('dealerCards');
const dealerScoreEl=document.getElementById('dealerScore');
const playerPanelEl=document.getElementById('playerPanel');
const statusEl=document.getElementById('status');
const chipsEl=document.getElementById('chips');
const betInput=document.getElementById('betInput');
const dealBtn=document.getElementById('dealBtn');
const hitBtn=document.getElementById('hitBtn');
const standBtn=document.getElementById('standBtn');
const doubleBtn=document.getElementById('doubleBtn');
const splitBtn=document.getElementById('splitBtn');
const restartBtn=document.getElementById('restartBtn');
const insuranceBtn=document.getElementById('insuranceBtn');
const surrenderBtn=document.getElementById('surrenderBtn');
const keySettingsBtn=document.getElementById('keySettingsBtn');
const keyModal=document.getElementById('keyModal');
const saveKeysBtn=document.getElementById('saveKeysBtn');
const notificationEl=document.getElementById('notification');
const statsEl=document.getElementById('stats');
const dealerHistoryEl=document.getElementById('dealerHistory');
const themeToggleBtn=document.getElementById('themeToggleBtn');
const preset10=document.getElementById('preset10');
const preset50=document.getElementById('preset50');
const preset100=document.getElementById('preset100');

// --- Utility ---
function buildDeck(){const d=[];for(const s of SUITS)for(const r of RANKS)d.push({suit:s,rank:r.r,value:r.value});return d;}
function shuffle(deck){for(let i=deck.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[deck[i],deck[j]]=[deck[j],deck[i]];}}
function dealCard(to){if(deck.length===0){deck=buildDeck();shuffle(deck);}const card=deck.pop();to.push(card);return card;}
function calculateScore(hand){let sum=0,aces=0;for(const c of hand){sum+=c.value;if(c.rank==='A')aces++;}while(sum>21&&aces>0){sum-=10;aces--;}return sum;}
function showNotification(msg,color='#f00'){notificationEl.textContent=msg;notificationEl.style.color=color;notificationEl.style.opacity=1;setTimeout(()=>notificationEl.style.opacity=0,800);}
function updateChips(){chipsEl.textContent=chips;}
function saveChips(){localStorage.setItem('bjChips',chips);}
function loadChips(){const v=localStorage.getItem('bjChips');if(v!==null)chips=parseInt(v);updateChips();}
function updateStats(){statsEl.textContent=`Wins: ${stats.wins} | Losses: ${stats.losses} | Blackjacks: ${stats.blackjacks}`;}
function updateDealerHistory(){dealerHistoryEl.textContent='Dealer Last Cards: '+dealerHistory.map(c=>c.rank+c.suit).join(' ');}
function animateCard(cardEl){cardEl.classList.add('animate');setTimeout(()=>cardEl.classList.remove('animate'),200);}
function toggleTheme(){document.body.classList.toggle('light');}

// --- Render Card with red hearts/diamonds ---
function renderCard(card, hidden=false){
  const div = document.createElement('div');
  div.className = 'card' + (hidden ? ' hidden-card' : '');
  if(!hidden && (card.suit === '♥' || card.suit === '♦')) div.classList.add('red');
  div.innerHTML = `
    <div class="top-left">${hidden?'&nbsp;
  </div>`; // closes innerHTML of renderCard
  return div;
}

// --- Initialize ---
deck=buildDeck();
shuffle(deck);
updateChips();
loadChips();
updateStats();
dealerHistory=[];

</script>
</body>
</html>
